# Reactor的事件驱动机制

## 介绍

普通函数调用的机制：程序调用某函数，函数执行，程序等待，函数将结果和控制权返回给程序，程序继续处理。

Reactor机制：应用程序不是主动的调用某个API完成处理，而是恰恰相反，Reactor逆置了事件处理流程，应用程序需要提供相应的接口并注册到Reactor上，如果相应的事件发生，Reactor将主动调用应用程序注册的接口，这些接口又称为“回调函数”。

普通调用机制是从上层应用驱动，而Reactor机制则是由底层的事件反应堆来驱动。

I/O多路复用是Reactor模式最常用编程模式。

由于Reactor模式的事件循环特性，Reactor的事件处理程序是要求非阻塞的。

## Reactor的优点
Reactor模式是编写高性能网络服务器的必备技术之一，它具有如下的优点：

+ I/O和timer事件是多路复用的，响应快，不必为单个同步时间所阻塞，虽然Reactor本身依然是同步的；
+ 编程相对简单，Reactor多为单线程驱动，可以最大程度的避免复杂的多线程及同步问题，并且避免了多线程/进程的切换开销；
+ 可扩展性，可以方便的通过增加Reactor实例个数来充分利用CPU资源；
+ 可复用性，Reactor框架本身与具体事件处理逻辑无关，具有很高的复用性；

## 组成部分

### 事件源
最常见的额事件有网络I/O事件，文件I/O事件，timer事件。

### 多路分发机制
操作系统提供的I/O多路复用机制，如select、poll、epoll。

程序将其关心的事件注册到多路复用器上，当事件发生时，多路复用器会给出通知。

### 反应器
运行事件循环，当多路复用给出事件通知后，调用注册的事件处理程序处理事件。

### 事件处理程序
事件处理程序提供一组接口，每个接口定义了事件以及事件处理程序，当反应器上有相应的事件发生时，则执行相应的事件处理程序。
